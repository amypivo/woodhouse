{"name":"Woodhouse","tagline":"An AMQP-based background worker system for Ruby.","body":"# Woodhouse\r\n\r\n[<img src=\"https://secure.travis-ci.org/mboeh/woodhouse.png?branch=master\" alt=\"Build Status\" />](http://travis-ci.org/mboeh/woodhouse)\r\n\r\nAn AMQP-based background worker system for Ruby designed to make managing heterogenous tasks relatively easy.\r\n\r\nThe use case for Woodhouse is for reliable and sane performance in situations where jobs on a single queue may vary significantly\r\nin length. The goal is to permit large numbers of quick jobs to be serviced even when many slow jobs are in the queue. A secondary\r\ngoal is to provide a sane way for jobs on a given queue to be given special priority or dispatched to a server more suited to them.\r\n\r\nWoodhouse 0.0.x is production-ready for Rails 2 and Ruby 1.8, while 0.1.x is in active development for Ruby 1.9.\r\n\r\n## Usage\r\n\r\n### Rails\r\n\r\nAdd\r\n\r\n      gem 'woodhouse', github: 'mboeh/woodhouse'\r\n\r\nto your Gemfile.\r\n\r\nRun\r\n      \r\n      % rails generate woodhouse\r\n\r\nto create script/woodhouse and config/initializers/woodhouse.rb.\r\n\r\n### Basic Usage\r\n\r\nThe simplest way to set up a worker class is to include Woodhouse::Worker and define public methods.\r\n\r\n      class IsisWorker\r\n        include Woodhouse::Worker\r\n\r\n        def pam_gossip(job)\r\n          puts \"Pam gossips about #{job[:who]}.\"\r\n        end\r\n\r\n        def sterling_insult(job)\r\n          puts \"Sterling insults #{job[:who]}.\"\r\n        end\r\n      end\r\n\r\nJobs are dispatched asynchronously to a worker by adding `async_` to the method name:\r\n\r\n      IsisWorker.async_pam_gossip :who => \"Cyril\"\r\n\r\nWoodhouse jobs always take a hash of arguments. The worker receives a Woodhouse::Job, which acts like a hash\r\nbut also supplies additional functionality.\r\n\r\n### Dispatchers\r\n\r\nThe dispatcher used for sending out jobs can be set in the Woodhouse config block:\r\n\r\n      Woodhouse.configure do |woodhouse|\r\n        woodhouse.dispatcher_type = :local # :local_pool | :amqp\r\n      end\r\n      \r\nCalling the `async` version of a job method sends it to the currently configured dispatcher. The default dispatcher\r\ntype is `:local`, which simply executes the job synchronously (although still passing it through middleware; see below).\r\n\r\nIf you want `girl_friday` style in-process threaded backgrounding, you can get that by selecting the `:local_pool`\r\ndispatcher.\r\n\r\nFinally, if you want to run your jobs in a background process, you'll need to set up the `:amqp` dispatcher. This will\r\nuse either the Hot Bunnies library (on JRuby) or the Bunny library (on all other Ruby engines). Bunny is suitable for\r\ndispatch but can be a little bit CPU-hungry in the background process. Hot Bunnies works great for both. You don't have\r\nto use the same Ruby version for your background process as for the dispatching application -- we use Woodhouse in production\r\nwith a JRuby background process and MRI frontend processes.\r\n\r\nYou'll also need to have RabbitMQ running. If it's running with the default (open) permissions on the local server, you don't\r\nneed to configure it at all. Otherwise, you'll have to set the server connection info. You have two options for this. On Rails,\r\nyou can create a config/woodhouse.yml file, formatted similar to config/database.yml:\r\n\r\n      production:\r\n        host: myrabbitmq.server.local\r\n        vhost: /some-vhost\r\n\r\n(The parameters accepted here are the same used for Bunny.connect; I promise to document them here soon.)\r\n\r\nOtherwise, you can do it in the Woodhouse config block:\r\n\r\n      Woodhouse.configure do |woodhouse|\r\n        woodhouse.server_info = { :host => \"myrabbitmq.server.local\" }\r\n      end\r\n\r\n### Running The Background Process\r\n\r\nAll you have to do is run `script/woodhouse`. It'll load your Rails environment and start the server process. It responds to QUIT\r\nand INT signals correctly; I'm working on seeing if I can get it to restart worker processes with HUP and to dump/load the current\r\nlayout with USR1/USR2.\r\n\r\n`script/woodhouse` logs job execution and results to `log/woodhouse.log`.\r\n\r\n### Performance Errata\r\n\r\nIf you're using JRuby with a large application, I've found that the JVM's permanent generation can get exhausted. If you have\r\nplenty of heap but still get GC overhead errors, try bumping up the PermGen by including this on the JRuby command line:\r\n\r\n      -J-XX:MaxPermSize=128m\r\n\r\nPerformance will generally be better with the `--server` flag:\r\n\r\n      --server\r\n\r\nA lot of the jobs I run tend to allocate and dispose a lot of memory very quickly, and Woodhouse will be a long-running process.\r\nI've gotten good results from enabling aggressive heap tuning:\r\n\r\n      -J-XX:+AggressiveHeap\r\n\r\n## Features\r\n\r\n* Configurable worker sets per server\r\n* Configurable number of threads per worker\r\n* Segmenting a single queue among multiple workers based on job characteristics (using AMQP header exchanges)\r\n* Progress reporting on jobs\r\n* New Relic background job reporting\r\n* Job dispatch and execution middleware stacks\r\n\r\n## Upcoming \r\n\r\n* Live reconfiguration of workers -- add or remove workers across one or more nodes without restarting\r\n* Persistent configuration changes -- configuration changes saved to a data store and kept across deploys\r\n* Watchdog/status workers on every node\r\n* Web interface\r\n\r\n## To Do\r\n\r\n* Examples and guides\r\n* More documentation\r\n* Watchdog system\r\n\r\n## Supported Versions\r\n\r\n### woodhouse 0.1.x\r\n\r\n* bunny 0.9.x, RabbitMQ 2.x or later\r\n* ruby 1.9\r\n* MRI, JRuby, Rubinius 2\r\n\r\n### woodhouse 0.0.x\r\n\r\n* ruby 1.8\r\n* MRI, JRuby, Rubinius\r\n\r\n### Acknowledgements\r\n\r\nWoodhouse originated in a substantially modified version of the Workling background worker system, although all code has since\r\nbeen replaced.\r\n\r\nThis library was developed for [CrowdCompass](http://crowdcompass.com) and was released as open source with their permission.\r\n","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}